<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Simulations using an R6 Class for a Boilerplate Workflow • Simulacron3</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="apple-touch-icon-60x60.png">
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.4.0/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.4.0/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Simulations using an R6 Class for a Boilerplate Workflow">
<meta name="description" content="What the package does (one paragraph).">
<meta property="og:description" content="What the package does (one paragraph).">
<meta property="og:image" content="https://ctesta01.github.io/Simulacron3/logo.png">
<style> img.logo { width: 200px !important; } </style>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">Simulacron3</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.001</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="articles/Comparing-Estimators.html">Comparing Estimators</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header">
<img src="logo.png" class="logo" alt=""><h1 id="simulacron3-">
<code>{Simulacron3}</code> <a class="anchor" aria-label="anchor" href="#simulacron3-"></a>
</h1>
</div>
<p>The purpose of the <a href="https://ctesta01.github.io/Simulacron3/">Simulacron3</a> package is to provide easy-to-use boilerplate functionality for simple simulation studies. The most archetypal example of a usecase is comparing the performance of multiple estimators as the sample size of training data increases.</p>
<p>A fundamental thesis of this package is that many simulation studies (of the statistical performance of estimators) follow the following workflow:</p>
<figure><img src="reference/figures/simulation_diagram.png" alt="A flow diagram with simulation (sim) in the middle, data generating process (dgp), estimators, and config (iterations, sample sizes, etc) leading into it, and out of the simulation coming summary statistics."><figcaption aria-hidden="true">
A flow diagram with simulation (sim) in the middle, data generating process (dgp), estimators, and config (iterations, sample sizes, etc) leading into it, and out of the simulation coming summary statistics.
</figcaption></figure><div class="section level2">
<h2 id="demonstration">Demonstration<a class="anchor" aria-label="anchor" href="#demonstration"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ctesta01.github.io/Simulacron3/">Simulacron3</a></span><span class="op">)</span> </span>
<span><span class="co"># the only thing Simulacron3 contains is the Simulation R6 Class, used below</span></span>
<span></span>
<span><span class="co"># Example Usage</span></span>
<span><span class="co"># Define a data generating process</span></span>
<span><span class="va">dgp</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define some estimators </span></span>
<span><span class="va">estimators</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  mean_estimator <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">x</span><span class="op">)</span>,</span>
<span>  var_estimator <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">var</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define a summary statistics function </span></span>
<span><span class="co"># </span></span>
<span><span class="co"># An estimator can potentially return a lot more data than can be stored</span></span>
<span><span class="co"># in one row of results, so the summary_stats functions are used to </span></span>
<span><span class="co"># condense that information down.  Here they're not doing very much, but</span></span>
<span><span class="co"># in more advanced simulations we will see why they're crucial. </span></span>
<span><span class="va">summary_func</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">iter</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">est_results</span>, <span class="va">data</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    mean_est <span class="op">=</span> <span class="va">est_results</span><span class="op">$</span><span class="va">mean_estimator</span>,</span>
<span>    var_est <span class="op">=</span> <span class="va">est_results</span><span class="op">$</span><span class="va">var_estimator</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Create a simulation object</span></span>
<span><span class="va">sim</span> <span class="op">&lt;-</span> <span class="va"><a href="reference/Simulation.html">Simulation</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set up the simulation</span></span>
<span><span class="va">sim</span><span class="op">$</span><span class="fu">set_dgp</span><span class="op">(</span><span class="va">dgp</span><span class="op">)</span></span>
<span><span class="va">sim</span><span class="op">$</span><span class="fu">set_estimators</span><span class="op">(</span><span class="va">estimators</span><span class="op">)</span></span>
<span><span class="va">sim</span><span class="op">$</span><span class="fu">set_config</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>replications <span class="op">=</span> <span class="fl">5000</span>, sample_size <span class="op">=</span> <span class="fl">500</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">sim</span><span class="op">$</span><span class="fu">set_summary_stats</span><span class="op">(</span><span class="va">summary_func</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Run the simulation</span></span>
<span><span class="va">sim</span><span class="op">$</span><span class="fu">run</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Retrieve results</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="va">sim</span><span class="op">$</span><span class="fu">get_results</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="do">##       mean_est   var_est</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="do">## 1 -0.000358145 1.0029123</span></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="do">## 2  0.014233217 0.9832642</span></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="do">## 3 -0.053425707 0.9297267</span></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a><span class="do">## 4  0.004113618 1.0936967</span></span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a><span class="do">## 5 -0.084775258 0.9653678</span></span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a><span class="do">## 6  0.022799863 1.0084176</span></span></code></pre></div>
<p>See <a href="https://ctesta01.github.io/Simulacron3/articles/Comparing-Estimators.html" class="uri">https://ctesta01.github.io/Simulacron3/articles/Comparing-Estimators.html</a> for a slightly more involved example.</p>
</div>
<div class="section level2">
<h2 id="parallelization">Parallelization<a class="anchor" aria-label="anchor" href="#parallelization"></a>
</h2>
<p>Parallelization is supported, and as simple as passing <code>parallel = TRUE</code> to the <code>config</code> for your simulation and declaring a <code>plan(multisession)</code> with the <a href="https://future.futureverse.org" class="external-link">future</a> package.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/joshuaulrich/microbenchmark/" class="external-link">microbenchmark</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># let's benchmark the simulation we specified above </span></span>
<span><span class="fu">microbenchmark</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span><span class="va">sim</span><span class="op">$</span><span class="fu">run</span><span class="op">(</span><span class="op">)</span>, times <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="do">## Warning in microbenchmark::microbenchmark(sim$run(), times = 10): less accurate</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="do">## nanosecond times to avoid potential integer overflows</span></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a><span class="do">## Unit: milliseconds</span></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a><span class="do">##       expr      min       lq     mean   median       uq      max neval</span></span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a><span class="do">##  sim$run() 824.2277 838.2386 846.9038 844.4248 852.6623 886.7453    10</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># just change the config to run in parallel</span></span>
<span><span class="va">sim</span><span class="op">$</span><span class="fu">set_config</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>parallel <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="fu">future</span><span class="fu">::</span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="fu">future</span><span class="fu">::</span><span class="va"><a href="https://future.futureverse.org/reference/multisession.html" class="external-link">multisession</a></span><span class="op">)</span> <span class="co"># setup an appropriate future::plan </span></span>
<span><span class="fu">microbenchmark</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span><span class="va">sim</span><span class="op">$</span><span class="fu">run</span><span class="op">(</span><span class="op">)</span>, times <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="do">## Unit: milliseconds</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a><span class="do">##       expr      min       lq     mean   median       uq     max neval</span></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a><span class="do">##  sim$run() 589.8162 597.6803 676.0713 613.2764 619.8425 964.878    10</span></span></code></pre></div>
<p>Underlying this is usage of the <a href="https://future.apply.futureverse.org" class="external-link">future.apply</a> package. See <a href="https://future.futureverse.org/" class="external-link uri">https://future.futureverse.org/</a> for a description of the types of plans that can be specified.</p>
</div>
<div class="section level2">
<h2 id="package-internals">Package Internals<a class="anchor" aria-label="anchor" href="#package-internals"></a>
</h2>
<p><a href="https://ctesta01.github.io/Simulacron3/">Simulacron3</a> is meant to have easy to understand source code (and not too much of it) so that users can easily reason about what to expect from their simulations. Check out the source, especially for the <code>$run()</code> method here:</p>
<ul>
<li><a href="https://github.com/ctesta01/Simulacron3/blob/main/R/Simulation.R" class="external-link uri">https://github.com/ctesta01/Simulacron3/blob/main/R/Simulation.R</a></li>
</ul>
<div class="section level3">
<h3 id="package-title-inspiration">Package Title Inspiration<a class="anchor" aria-label="anchor" href="#package-title-inspiration"></a>
</h3>
<p>To quote Wikipedia:</p>
<p><img src="https://upload.wikimedia.org/wikipedia/en/7/70/DanielFGalouye-Simulacron-3.jpg" align="left" hspace="15" width="100px"></p>
<blockquote>
<p>Simulacron-3 (1964), by Daniel F. Galouye, is an American science fiction novel featuring an early literary description of a simulated reality. <br><br> … As time and events unwind, [Fuller] progressively grasps that his own world is probably not “real” and might be only a computer-generated simulation.</p>
</blockquote>
<p><br><br></p>
</div>
</div>
<div class="section level2">
<h2 id="other-related-works">Other Related Works<a class="anchor" aria-label="anchor" href="#other-related-works"></a>
</h2>
<p><a href="https://ctesta01.github.io/Simulacron3/">Simulacron3</a> is one of many attempts to help with the workflow of running simulations. A lot of inspiration was taken from:</p>
<ul>
<li><a href="https://github.com/Yu-Group/simChef" class="external-link">simChef</a></li>
<li><a href="https://avi-kenny.github.io/SimEngine/" class="external-link">SimEngine</a></li>
<li><a href="https://www.jstatsoft.org/article/view/v081i02" class="external-link">simcausal</a></li>
<li><a href="https://github.com/jacobbien/simulator" class="external-link">simulator</a></li>
</ul>
</div>
</div>
  </main><aside class="col-md-3"><div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing Simulacron3</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Christian Testa <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0001-9103-5839" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
</ul>
</div>



  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Christian Testa.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
